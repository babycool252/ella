{{ 'component-header-verdura.css' | asset_url | stylesheet_tag }}

<header class="header-verdura section-{{ section.id }}-padding" 
        style="--bg-color: {{ section.settings.background_color }}; --text-color: {{ section.settings.text_color }}; --padding-top: {{ section.settings.padding_top }}px; --padding-bottom: {{ section.settings.padding_bottom }}px;">
  <div class="header-verdura__container container-{{ section.settings.container }}">
    <!-- 左侧 MENU -->
    <div class="header-verdura__left">
      <button class="header-verdura__menu-button" type="button" aria-label="Open menu">
        <span class="header-verdura__menu-text">MENU</span>
      </button>
    </div>

    <!-- 中间 VERDURA LOGO -->
    <div class="header-verdura__center">
      <a href="{{ routes.root_url }}" class="header-verdura__logo-link">
        <!-- 皇冠图标 -->
        <div class="header-verdura__crown">
          <svg width="40" height="24" viewBox="0 0 40 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- 皇冠底部 -->
            <rect x="2" y="18" width="36" height="4" fill="currentColor"/>
            <!-- 皇冠尖峰 -->
            <path d="M20 2L16 14L8 12L6 16L12 16L16 16L20 16L24 16L28 16L34 16L32 12L24 14L20 2Z" fill="currentColor"/>
            <!-- 左侧尖峰 -->
            <path d="M6 8L10 14L14 12L12 16L6 16L6 8Z" fill="currentColor"/>
            <!-- 右侧尖峰 -->
            <path d="M34 8L34 16L28 16L26 12L30 14L34 8Z" fill="currentColor"/>
            <!-- 宝石装饰 -->
            <circle cx="20" cy="10" r="1.5" fill="currentColor"/>
            <circle cx="12" cy="13" r="1" fill="currentColor"/>
            <circle cx="28" cy="13" r="1" fill="currentColor"/>
          </svg>
        </div>
        
        <!-- VERDURA 文字 -->
        <div class="header-verdura__logo-text">
          <span class="header-verdura__brand-name">{{ section.settings.brand_name | default: 'VERDURA' }}</span>
          <span class="header-verdura__established">{{ section.settings.established_text | default: 'EST. 1939' }}</span>
        </div>
      </a>
    </div>

    <!-- 右侧 CART -->
    <div class="header-verdura__right">
      <a href="{{ routes.cart_url }}" class="header-verdura__cart-link" aria-label="Shopping cart">
        <span class="header-verdura__cart-text">CART (</span>
        <span class="header-verdura__cart-count" data-cart-count="{{ cart.item_count }}">{{ cart.item_count }}</span>
        <span class="header-verdura__cart-text">)</span>
      </a>
    </div>
  </div>
</header>

<!-- 移动端菜单抽屉 -->
<div class="header-verdura__menu-drawer" data-menu-drawer>
  <div class="header-verdura__menu-overlay" data-menu-overlay></div>
  <div class="header-verdura__menu-content">
    <div class="header-verdura__menu-header">
      <span class="header-verdura__menu-title">{{ section.settings.menu_title | default: 'Menu' }}</span>
      <button class="header-verdura__menu-close" data-menu-close aria-label="Close menu">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    
    <nav class="header-verdura__navigation">
      {%- assign menu_handle = section.settings.menu | default: 'main-menu' -%}
      {% for link in linklists[menu_handle].links %}
        <a href="{{ link.url }}" class="header-verdura__nav-link">{{ link.title }}</a>
      {% endfor %}
    </nav>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const sectionId = '{{ section.id }}';
  const menuButton = document.querySelector('.header-verdura__menu-button');
  const menuDrawer = document.querySelector('.header-verdura__menu-drawer');
  const menuOverlay = document.querySelector('.header-verdura__menu-overlay');
  const menuClose = document.querySelector('.header-verdura__menu-close');

  function openMenu() {
    if (menuDrawer) {
      menuDrawer.classList.add('header-verdura__menu-drawer--open');
      document.body.classList.add('header-verdura__menu-open');
    }
  }

  function closeMenu() {
    if (menuDrawer) {
      menuDrawer.classList.remove('header-verdura__menu-drawer--open');
      document.body.classList.remove('header-verdura__menu-open');
    }
  }

  if (menuButton) {
    menuButton.addEventListener('click', openMenu);
  }

  if (menuOverlay) {
    menuOverlay.addEventListener('click', closeMenu);
  }

  if (menuClose) {
    menuClose.addEventListener('click', closeMenu);
  }

  // ESC键关闭菜单
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && menuDrawer && menuDrawer.classList.contains('header-verdura__menu-drawer--open')) {
      closeMenu();
    }
  });

  // 监听购物车更新
  document.addEventListener('cart:changed', function(event) {
    const cartCount = document.querySelector('.header-verdura__cart-count');
    if (cartCount && event.detail) {
      cartCount.textContent = event.detail.item_count || 0;
    }
  });
});
</script>

<style>
  .section-{{ section.id }}-padding {
    padding-top: var(--padding-top, 20px);
    padding-bottom: var(--padding-bottom, 20px);
  }
</style>

{% schema %}
{
  "name": "Header Verdura",
  "tag": "header",
  "class": "section-header",
  "settings": [
    {
      "type": "header",
      "content": "Brand Settings"
    },
    {
      "type": "text",
      "id": "brand_name",
      "label": "Brand Name",
      "default": "VERDURA"
    },
    {
      "type": "text",
      "id": "established_text",
      "label": "Established Text",
      "default": "EST. 1939"
    },
    {
      "type": "header",
      "content": "Menu Settings"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "text",
      "id": "menu_title",
      "label": "Menu Drawer Title",
      "default": "Menu"
    },
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "select",
      "id": "container",
      "label": "Container width",
      "default": "default",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "fullwidth",
          "label": "Full width"
        },
        {
          "value": "1170",
          "label": "1170px"
        },
        {
          "value": "1570",
          "label": "1570px"
        },
        {
          "value": "1770",
          "label": "1770px"
        }
      ]
    },
    {
      "type": "header",
      "content": "Style Settings"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#333333"
    },
    {
      "type": "header",
      "content": "Spacing Settings"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Padding top",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px", 
      "label": "Padding bottom",
      "default": 20
    }
  ],
  "presets": [
    {
      "name": "Header Verdura",
      "settings": {
        "brand_name": "VERDURA",
        "established_text": "EST. 1939",
        "menu": "main-menu",
        "menu_title": "Menu",
        "container": "default",
        "background_color": "#ffffff",
        "text_color": "#333333",
        "padding_top": 20,
        "padding_bottom": 20
      }
    }
  ]
}
{% endschema %}
